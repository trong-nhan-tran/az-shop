generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
  engineType      = "library"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["public"]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model banners {
  id            Int         @id @default(autoincrement())
  created_at    DateTime    @default(now()) @db.Timestamptz(6)
  desktop_image String
  direct_link   String?
  category_id   Int?
  mobile_image  String?
  order_number  Int         @default(0)
  categories    categories? @relation(fields: [category_id], references: [id], onUpdate: NoAction, map: "banner_images_category_id_fkey")

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model cart_items {
  created_at      DateTime      @default(now()) @db.Timestamptz(6)
  profile_id      String        @db.Uuid
  product_item_id Int
  quantity        Int           @default(1)
  id              Int           @id(map: "cart-items_pkey") @unique(map: "cart-items_id_key") @default(autoincrement())
  product_items   product_items @relation(fields: [product_item_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "cart-items_product_item_id_fkey")
  profiles        profiles      @relation(fields: [profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "cart-items_profile_id_fkey")

  @@unique([product_item_id, profile_id], map: "cart_items_product_item_id_profile_id_unique")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model categories {
  id             Int              @id(map: "category_pkey") @default(autoincrement())
  created_at     DateTime         @default(now()) @db.Timestamptz(6)
  name           String           @unique(map: "category_name_key")
  slug           String           @unique
  order_number   Int?
  thumbnail      String?
  banners        banners[]
  featured_items featured_items[]
  subcategories  subcategories[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model featured_items {
  id                 Int               @id(map: "featured_products_pkey") @default(autoincrement())
  created_at         DateTime          @default(now()) @db.Timestamptz(6)
  product_variant_id Int?
  category_id        Int?
  order_number       Int?
  product_variants   product_variants? @relation(fields: [product_variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  categories         categories?       @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "featured_products_category_id_fkey")

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model flash_sale {
  id               Int                @id @default(autoincrement())
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  enable           Boolean            @default(false)
  name             String
  start_at         DateTime           @db.Timestamptz(6)
  end_at           DateTime?          @db.Timestamptz(6)
  flash_sale_items flash_sale_items[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model flash_sale_items {
  id              Int           @id @default(autoincrement())
  created_at      DateTime      @default(now()) @db.Timestamptz(6)
  product_item_id Int
  sale_price      Int           @default(0)
  quantity        Int           @default(0)
  flash_sale_id   Int
  sold_quantity   Int           @default(0)
  flash_sale      flash_sale    @relation(fields: [flash_sale_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_items   product_items @relation(fields: [product_item_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model news_feeds {
  id         Int      @id @default(autoincrement())
  created_at DateTime @default(now()) @db.Timestamptz(6)
  title      String
  slug       String   @unique
  thumbnail  String
  content    String?

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model order_items {
  id              Int            @id @default(autoincrement())
  created_at      DateTime       @default(now()) @db.Timestamptz(6)
  product_name    String
  color_name      String
  price           Decimal        @db.Decimal
  quantity        Int            @default(1)
  product_item_id Int?
  order_id        Int?
  thumbnail       String?
  variant         String?
  orders          orders?        @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_items   product_items? @relation(fields: [product_item_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("public")
}


/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model orders {
  id             Int            @id @default(autoincrement())
  created_at     DateTime       @default(now()) @db.Timestamptz(6)
  customer_name  String
  customer_phone String
  address        String
  profile_id     String?        @db.Uuid
  payment_status payment_status @default(unpaid)
  payment_method payment_method @default(cod)
  order_status   order_status   @default(pending)
  total_amount   Int
  order_items    order_items[]
  profiles       profiles?      @relation(fields: [profile_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model product_colors {
  id            Int             @id(map: "images_pkey") @default(autoincrement())
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  images        String[]
  color_name    String
  product_id    Int
  thumbnail     String?
  products      products        @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "product_images_product_id_fkey")
  product_items product_items[]

  @@unique([product_id, color_name])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model product_items {
  id                 Int                @id(map: "stocks_pkey") @default(autoincrement())
  created_at         DateTime           @default(now()) @db.Timestamptz(6)
  product_color_id   Int
  product_variant_id Int
  sold_count         Int                @default(0)
  price              Int                @default(0)
  is_available       Boolean?           @default(false)
  cart_items         cart_items[]
  flash_sale_items   flash_sale_items[]
  order_items        order_items[]
  product_variants   product_variants   @relation(fields: [product_variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "product_items_product_item_id_fkey")
  product_colors     product_colors     @relation(fields: [product_color_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "stocks_product_color_id_fkey")

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model product_variants {
  id             Int              @id(map: "product_pkey") @default(autoincrement())
  created_at     DateTime         @default(now()) @db.Timestamptz(6)
  name           String           @unique(map: "product_name_key")
  listed_price   Int
  slug           String           @unique(map: "products_slug_key")
  variant        String           @default("single")
  product_id     Int?
  thumbnail      String?
  base_price     Int
  featured_items featured_items[]
  product_items  product_items[]
  products       products?        @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "product_items_product_id_fkey")

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model products {
  id               Int                @id(map: "product_series_pkey") @default(autoincrement())
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  name             String
  description      String?
  subcategory_id   Int?
  product_colors   product_colors[]
  product_variants product_variants[]
  subcategories    subcategories?     @relation(fields: [subcategory_id], references: [id], onUpdate: NoAction)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model profiles {
  id         String       @id @db.Uuid
  name       String?
  created_at DateTime?    @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  phone      String?
  avatar_url String?
  address    String?
  email      String?
  cart_items cart_items[]
  orders     orders[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model subcategories {
  id           Int         @id @default(autoincrement())
  created_at   DateTime    @default(now()) @db.Timestamptz(6)
  name         String      @unique
  slug         String      @unique
  order_number Int?
  category_id  Int?
  products     products[]
  categories   categories? @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("public")
}

enum order_status {
  pending
  confirmed
  completed
  canceled

  @@schema("public")
}

enum payment_method {
  cod
  momo

  @@schema("public")
}

enum payment_status {
  paid
  unpaid
  failed

  @@schema("public")
}
